{%load static%}
<!DOCTYPE html>
<html lang="en">
<head>
<style type="text/css">

{
    margin: 0;
    padding: 0;
    font-family: Arial, 'Arial Narrow', Helvetica, sans-serif;
    font-size: 12px;
    line-height: 17px;
    color: #000000;
    -webkit-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
}
 table {
    table-layout: fixed;
}
 table td {
    word-break: break-word;
}
 table, th, td {
    border-collapse: collapse;
}
.table-bordered {
    border: 1px solid #000000;
}
.table-bordered th, .table-bordered td {
    border-top: 1px solid #000000;
    border-right: 1px solid #000000;
}
.table-bordered tbody tr:first-child td {
    border-top: none;
}
.table-bordered tbody tr td:last-child {
    border-right: none;
}
.table-pad th, .table-pad td {
    padding: 5px 10px;
}
.t-b-0 td {
    border: 0 !important;
}
.t-p-0 td {
    padding: 0;
}
.t-py-0 td {
    padding-top: 0;
    padding-bottom: 0;
}
.bt-1 {
    border-top: 1px solid #000000 !important;
}
.br-0 {
    border-right: 0 !important;
}
.bb-0 {
    border-bottom: 0 !important;
}
.p-0 {
    padding: 0 !important;
}
.p-5 {
    padding: 5px;
}
.p-10 {
    padding: 10px;
}
.pt-5 {
    padding-top: 5px;
}
.pt-15 {
    padding-top: 15px;
}
.pl-10 {
    padding-left: 10px;
}
.px-10 {
    padding-left: 10px;
    padding-right: 10px;
}
.px-15 {
    padding-left: 15px;
    padding-right: 15px;
}
.py-10 {
    padding-top: 15px;
    padding-bottom: 15px;
}
.f-15 {
    font-size: 15px;
    line-height: 18px;
}
.text-red {
    color: #cf2b20;
}
.text-right {
    text-align: right;
}
.d-block {
    display: block;
}

.border-box {
    background-color: #dddae1;
    padding: 5px 10px;
    border: 1px solid #333266;
    border-radius: 8px;
}

.heading{
    font-size:50px;
    color:blue;
}
.sup {
 vertical-align: super;
 color:red;
}
 span.b-table {
  position: absolute;
  right: 0;
}
</style>
<script src="/js/jquery.min.js"></script>
<script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-html2canvas@latest/dist/jspdf-html2canvas.min.js"></script>
</head>
<body>
<div id="download-section">
    <br><br><br><br>
                <table width="1000" border="0" cellspacing="0" cellpadding="0">
            <tr>
                <td id="order-type" style="color:red" align="right">Consignee Copy</td>
            </tr>
        </table>
    <table width="1000" border="0" cellspacing="0" cellpadding="0" class="table-bordered table-pad" style="margin:20px;">

        <tr>
            <td valign="top" class="py-10">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="t-b-0">
                    <tr>
                        <td valign="top" width="120" class="px-15"><br><br><br><img src="{% static 'images/logo.jpg' %}" width="100" alt="Image"></td>
                        <td align="right">At Owner Risk
                            <table border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td align="center">
                                        <div class="heading">Indian Professional Logistics Royal<span class="sup">&#174;</span></div>
                                        <div>Loading Transporters for: Telangana, Madhya Pradesh, Maharastra, Chhatishghar<br>
                                        Site No.:311/1, 3rd Shriram Nagar, FCI Main Road, Gandhimaanagar, Peelamedu, Coimbatore - 4.<br>
                                            <strong>PHONE</strong>: 9443353836,7339000885, 99949807771,773,774, 0422-3254626 | <strong>EMAIL ID :</strong> iplroyal2017@gmail.com
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
        </tr>
        <tr>
            <td valign="top" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                    <td valign="top" width="60%" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td valign="top" width="47%">
                                <div><strong>Consignor Name :</strong></div>
                                <div class="px-10 pt-5">
                                    <strong>{{order.consignor.name}}</strong><br><br>
                                    {{order.consignor.address}}<br>
                                    {{order.consignor.contact_number}}</br>
                                    <strong>GST No : {{order.consignor.gstin}}</strong>
                                </div>
                            </td>
                            <td valign="top">
                                <div><strong>Consignee Name :</strong></div>
                                <div class="px-10 pt-5">
                                    <strong>{{order.consignee.name}}</strong><br><br>
                                    {{order.consignee.address}}<br>
                                    {{order.consignee.contact_number}}</br>
                                    <strong>GST No : {{order.consignee.gstin}}</strong>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top" colspan="2" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0" class="bt-1">
                                <tr>
                                    <td valign="top" width="90" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                        <tr>
                                            <td valign="top" height="80">
                                                <strong>PKGS:</strong><br>
                                                {{order.no_of_packages}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="bt-1">Total : {{order.no_of_packages}}</td>
                                        </tr>
                                    </table></td>
                                    <td valign="top">
                                        <strong>Description of Goods:</strong>
                                        <div>
                                            {{order.package_description}}
                                        </div>
                                    </td>
                                    <td valign="top" width="90" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                                        <tr>
                                            <td valign="top">
                                                <strong>Actual Weight:</strong><br>
                                                {{order.actual_weight}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="bt-1">
                                                <strong>Charged Weight:</strong><br>
                                                {{order.charged_weight}}
                                            </td>
                                        </tr>
                                    </table></td>
                                </tr>
                            </table></td>
                        </tr>
                        <tr>
                            <td colspan="2" class="bt-1">
                                <span>
                                    <strong>Invoice No :</strong>
                                    {{order.invoice_no}}
                                </span>
                                <span class="pl-10">
                                    <strong>Value :</strong>
                                    {% if value %}
                                    {{order.package_value}}
                                    {% endif %}
                                </span>
                                <span class="pl-10">
                                    <strong>Date :</strong>
                                    {{order.created_dtm|date:"Y-m-d"}}
                                </span>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" class="bt-1">
                                <span class="f-15 text-red">
                                    {% if payment_status == 'to_pay' %}
                                        TO PAY
                                    {% elif payment_status == 'tbb' %}
                                        TO BE BILLED
                                    {% elif payment_status == 'paid' %}
                                        PAID
                                    {% endif %}
                                </span>
                            </td>
                            <td class="bt-1">
                                <strong>GST Payable:</strong>
                                {{order.gs_tax_payable}}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="bt-1">
                                <div>
                                    Declaration by Consignor : We are fully aware of and accept the conditions of carriage given on the back side of the consignee <copy class=""></copy>
                                </div>
                                <div class="text-right pt-15">
                                    <strong>Subject of Coimbatore Jurisdiction</strong>
                                </div>
                            </td>
                        </tr>
                    </table></td>
                    <td valign="top" class="p-0"><table width="100%" border="0" cellspacing="0" cellpadding="0">
                        <tr>
                            <td valign="top" width="45%">
                                <strong class="f-15 text-red">LR-{{order.id}}</strong>
                            </td>
                            <td valign="top">
                                <strong>To : {{order.consignee_place}}</strong>
                            </td>
                        </tr>
                        <tr>
                            <td valign="top" class="bt-1">
                                <strong>Date :</strong> {{order.billing_date|date:"Y-m-d"}}
                            </td>
                            <td valign="top" class="bt-1">
                                <strong>Time :</strong> {{order.billing_date}}
                            </td>
                        </tr>
                        <tr>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>Freight Charge :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.freight_charges %}{{order.freight_charges}}{%else%}0{%endif%}
                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>LR Charge :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.lr_charges %}{{order.lr_charges}}{%else%}0{%endif%}

                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>Hamali :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.hamali_charges %}{{order.hamali_charges}}{%else%}0{%endif%}
                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>Door Collection :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.door_collection %}{{order.door_collection}}{%else%}0{%endif%}
                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>Door Delivery :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.door_delivery %}{{order.door_delivery}}{%else%}0{%endif%}
                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>Others :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.other_charges %}{{order.other_charges}}{%else%}0{%endif%}
                            </td>
                        </tr>
                        <tr>
                            <td class="bt-1">
                                <strong>GRAND TOTAL :</strong>
                            </td>
                            <td align="right" class="bt-1">
                                {%if order.total_charges %}{{order.total_charges}}{%else%}0{%endif%}

                            </td>
                        </tr>
                        <tr>
                            <td valign="bottom" height="70" align="center" colspan="2" class="bt-1">
                                <span style="font-size:20px;color:blue">For Indian Professional Logistics Royal<span class="sup">&#174;</span></span><br><br><br><br><br><br>
                                Authorised Signatory
                            </td>
                        </tr>
                    </table></td>
                </tr>
            </table></td>
        </tr>
    </table>
</div>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>

$(document).ready(function() {
     $("html").css("zoom", "1.7");
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    let page = $("#download-section");

    async function printPdf(copy_type) {
      const pdf = html2PDF(page, {
            jsPDF: {
                format: "a4",
                orientation: "p"
            },
            image: {type: 'jpeg', quality: 1},
            output: {{order.id}}+'_'+copy_type+'.pdf'
          });
      return pdf;
    }


    function saveFile(pdf, copy_type, copy_list){
        $.ajax({
            type: "POST",
            url: '/downloads?order_copy_type='+copy_type,
            headers: {'X-CSRFToken': csrftoken},
            data: {
                'id': {{order.id}},
                'type': 'order',
                'pdf_data': btoa(pdf.output())
            }
        }).done(function (result) {
            savePdf(copy_list);
        });
    }

    function savePdf(copy_list){
        if(copy_list.length > 0){
            copy_type = copy_list.pop();
            if(copy_type === "consignee"){
                $('#order-type').html("Consignee Copy");
            }
            else if(copy_type === "consignor"){
                $('#order-type').html("Consignor Copy");
            }
            else if(copy_type === "driver"){
                $('#order-type').html("Driver Copy");
            }
            else if(copy_type === "truck"){
                $('#order-type').html("Truck Copy");
            }
            printPdf(copy_type).then(pdf=>saveFile(pdf, copy_type, copy_list));
        }
        else{
            window.open('/landingpage?order_saved=1', "_self")
        }
    }
    var copy_list = ["consignee", "consignor", "driver", "truck"];
    savePdf(copy_list);
});
</script>
</body>
</html>